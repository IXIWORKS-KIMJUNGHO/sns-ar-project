<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>온누리교회 40주년 AR</title>
    
    <!-- AR.js와 A-Frame 라이브러리 로드 -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    
    <!-- 스타일시트 -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- 메타 태그 -->
    <meta name="description" content="온누리교회 40주년 건물 변천사를 AR로 체험해보세요">
</head>

<body>
    <!-- 로딩 화면 -->
    <div id="loading-screen">
        <div class="loading-content">
            <h2>온누리교회 40주년 AR</h2>
            <p>카메라를 준비하고 있습니다...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- AR 장면 -->
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <!-- 자산들 미리 로드 -->
        <a-assets>
            <!-- 3D 모델들 -->
            <a-asset-item id="church-model" src="assets/models/church-current.glb"></a-asset-item>
            
            <!-- 마커 패턴들 -->
            <!-- 기본 Hiro 마커 사용 (나중에 커스텀 마커로 교체) -->
        </a-assets>

        <!-- AR 마커 -->
        <a-marker 
            preset="hiro" 
            id="main-marker"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;">
            
            <!-- 3D 교회 모델 (기본적으로는 간단한 박스) -->
            <a-box 
                id="church-object"
                position="0 0.5 0" 
                rotation="0 45 0"
                scale="1 1 1"
                material="color: #8B4513; roughness: 0.8"
                animation="property: rotation; to: 0 405 0; loop: true; dur: 10000"
                class="clickable">
            </a-box>
            
            <!-- 정보 텍스트 -->
            <a-text 
                id="info-text"
                value="온누리교회&#10;1984년 설립"
                position="0 2 0"
                align="center"
                color="#FFFFFF"
                shader="msdf"
                font="roboto">
            </a-text>
        </a-marker>

        <!-- 카메라 -->
        <a-entity camera look-controls-enabled="false"></a-entity>
    </a-scene>

    <!-- App Title (Top Center) -->
    <div id="app-title" class="glass-subtle">
        <div class="app-title-content">온누리교회 40주년 AR</div>
    </div>

    <!-- Primary Action - Photo Capture (Right Side) -->
    <div id="primary-action">
        <button id="capture-btn" class="capture-button glass-primary">
            <span>📷</span>
        </button>
    </div>

    <!-- AR Status Indicator (Bottom Left) -->
    <div id="ar-status" class="glass-subtle">
        <div class="status-indicator scanning"></div>
        <span class="status-text">마커를 찾는 중...</span>
    </div>

    <!-- Info Panel (Bottom Center) - Shows when marker detected -->
    <div id="info-panel" class="glass-primary">
        <div class="info-content">
            <h4 id="period-title">온누리교회 40주년</h4>
            <p id="period-description">
                마커를 인식하면 교회의 역사를 AR로 체험할 수 있습니다.
            </p>
        </div>
    </div>

    <!-- AR Guide Modal -->
    <div id="marker-guide">
        <div class="guide-content glass-primary">
            <h3>AR 체험 방법</h3>
            <p>1. 카메라 권한을 허용해주세요</p>
            <p>2. Hiro 마커를 카메라에 비춰보세요</p>
            <p>3. 3D 교회 모델이 나타납니다!</p>
            <button id="close-guide">시작하기</button>
        </div>
    </div>

    <!-- JavaScript 파일들 로드 -->
    <script src="js/ar-controller.js"></script>

    <script>
        // 기본 초기화 코드
        document.addEventListener('DOMContentLoaded', function() {
            // 로딩 화면 숨기기
            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
            }, 2000);

            // 가이드 패널 닫기
            document.getElementById('close-guide').addEventListener('click', function() {
                document.getElementById('marker-guide').style.display = 'none';
            });

            // 사진 촬영 기능 (기본)
            document.getElementById('capture-btn').addEventListener('click', function() {
                // 나중에 스크린샷 기능 구현
                alert('사진 촬영 기능은 개발 중입니다!');
            });
        });

        // AR Status Management
        function updateARStatus(status, text) {
            const indicator = document.querySelector('.status-indicator');
            const statusText = document.querySelector('.status-text');
            
            // Remove all status classes
            indicator.classList.remove('scanning', 'error');
            
            // Add new status class
            if (status !== 'found') {
                indicator.classList.add(status);
            }
            
            statusText.textContent = text;
        }

        // AR 마커 감지 이벤트
        AFRAME.registerComponent('marker-handler', {
            init: function() {
                this.el.addEventListener('markerFound', function() {
                    console.log('마커를 찾았습니다!');
                    
                    // Update AR status
                    updateARStatus('found', '마커 인식됨');
                    
                    // Show info panel with animation
                    const infoPanel = document.getElementById('info-panel');
                    infoPanel.style.display = 'block';
                    infoPanel.classList.add('spring-enter');
                    
                    // Update info content for detected marker
                    document.getElementById('period-title').textContent = '교회 설립 (1984년)';
                    document.getElementById('period-description').textContent = '온누리교회가 하나님의 은혜 가운데 첫 걸음을 내딛었습니다. AR로 교회의 성장 과정을 체험해보세요.';
                });

                this.el.addEventListener('markerLost', function() {
                    console.log('마커를 잃었습니다.');
                    
                    // Update AR status
                    updateARStatus('scanning', '마커를 찾는 중...');
                    
                    // Hide info panel
                    const infoPanel = document.getElementById('info-panel');
                    infoPanel.style.display = 'none';
                    infoPanel.classList.remove('spring-enter');
                });
            }
        });

        // 마커에 컴포넌트 추가
        document.querySelector('#main-marker').setAttribute('marker-handler', '');
    </script>
</body>
</html>